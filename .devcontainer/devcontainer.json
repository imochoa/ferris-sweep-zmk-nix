// https://github.com/zmkfirmware/zmk#
{
  "name": "ZMK Development",
  "dockerFile": "Dockerfile",
  "build": {
    "args": {
      "USER_UID": "501" // 1000 by default
      // "USER_GID": "20" // 1000 by default
    }
  },
  "runArgs": [
        // Rootless podman
        // "--userns=keep-id:uid=501,gid=501",
        "--userns=keep-id",
    "--security-opt",
    "label=disable"
  ],
  // Rootless podman
  "updateRemoteUserUID": true,
  "containerEnv": {
    "WORKSPACE_DIR": "${containerWorkspaceFolder}",
// # export "CMAKE_PREFIX_PATH=/zmk-urchin/zephyr:$CMAKE_PREFIX_PATH"
// rm -rf /workspaces/firmware/*.uf2
// export Zephyr_DIR="/workspaces/zephyr/share/zephyr-package/cmake"
    "PROMPT_COMMAND": "history -a"
  },
  "remoteEnv": {
    "SSH_AUTH_SOCK": "/tmp/ssh-agent",
    "IS_DEVCONTAINER": "1",
    // For just modules 
    "JUST_UNSTABLE": "1"
  },
  "containerUser": "ubuntu", // 1000:1000 ubuntu
  // Defaults
  // "workspaceMount": "source=${localWorkspaceFolder},target=/workspace,type=bind",
  // "workspaceFolder": "/workspace",
  "mounts": [
    // volumes are more efficient than bind mounts on some systems (e.g., macOS) but they have to be unique,
    // so they will clash if you have multiple ZMK repositories
    // TODO: home 
    // "type=bind,source=${localWorkspaceFolder}/.home,target=/home/ubuntu"
    // Permission errors...
    // "type=bind,source=/tmp/ssh-agent.sock,target=/ssh-agent,idmap=true"
    // "type=bind,source=/tmp/ssh-agent.sock,target=/ssh-agent,rw=true"
  ],
  "customizations": {
    "vscode": {
      "extensions": [
        // ZMK
        "spadin.zmk-tools",
        "plorefice.devicetree",
        "legale.dts-formatter", // Does not work...
        "trond-snekvik.kconfig-lang", // Kconfig language support
        // C/C++
        "ms-vscode.cpptools",
        // ms-vscode.cpptools-extension-pack
        "usernamehw.errorlens"
      ],
      "settings": {
        "editor.formatOnSave": true,
        "[dts]": {
          // "editor.formatOnSave": false
        },
        "files.associations": {
          "*.keymap": "dts",
          "*.just": "just",
          "*.overlay": "dts",
          "*.conf": "properties"
        },
        "terminal.integrated.shell.linux": "/bin/bash"
        // "[dts]": {
        //   "editor.defaultFormatter": "legale.dts-formatter"
        // }
      }
    }
  },
  "forwardPorts": [
    // 3000
  ]
}

